<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="ä½œå“è¯¦æƒ… - éƒ­å¶èçš„ä¸ªäººä½œå“é›†">
    <title>ä½œå“è¯¦æƒ… - éƒ­å¶è</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        body {
            margin: 0;
            padding: 0;
        }
        
        .project-page {
            min-height: 100vh;
            padding-top: 0;
            background: var(--bg-primary);
        }
        
        .project-header {
            background: linear-gradient(135deg, var(--primary-blue) 0%, var(--secondary-blue) 100%);
            color: rgba(255, 255, 255, 0.95);
            padding: 8rem 0;
            margin-bottom: 3rem;
            margin-top: 0;
        }
        
        .project-header .back-btn {
            color: rgba(255, 255, 255, 0.9);
        }
        
        .project-header .project-title {
            color: rgba(255, 255, 255, 0.98);
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .project-header .project-description {
            color: rgba(255, 255, 255, 0.9);
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
        }
        
        .project-header .tag {
            color: rgba(255, 255, 255, 0.95);
        }
        
        .project-header .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 40px;
        }
        
        .back-btn {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            color: white;
            text-decoration: none;
            margin-bottom: 2rem;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }
        
        .back-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateX(-5px);
        }
        
        .project-title {
            font-size: 2.5rem;
            font-weight: 600;
            margin-bottom: 1rem;
        }
        
        .project-description {
            font-size: 1.1rem;
            line-height: 1.8;
            opacity: 0.95;
            max-width: 800px;
        }
        
        .project-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 0.75rem;
            margin-top: 1.5rem;
        }
        
        .project-tags .tag {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.9rem;
            backdrop-filter: blur(10px);
        }
        
        .project-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 40px 4rem;
        }
        
        .project-gallery-section {
            margin-top: 3rem;
        }
        
        .project-gallery-section h2 {
            font-size: 1.8rem;
            margin-bottom: 2rem;
            color: var(--text-primary);
        }
        
        @media (max-width: 768px) {
            .project-header {
                padding: 2rem 0;
            }
            
            .project-title {
                font-size: 1.8rem;
            }
            
            .project-description {
                font-size: 1rem;
            }
            
            .project-header .container,
            .project-content {
                padding: 0 20px;
            }
        }
    </style>
</head>
<body>


    <!-- ä½œå“è¯¦æƒ…é¡µé¢ -->
    <div class="project-page">
        <div class="project-header">
            <div class="container">
                <a href="index.html#projects" class="back-btn">
                    <span>â†</span> è¿”å›ä½œå“åˆ—è¡¨
                </a>
                <h1 class="project-title" id="projectTitle">åŠ è½½ä¸­...</h1>
                <p class="project-description" id="projectDescription"></p>
                <div class="project-tags" id="projectTags"></div>
            </div>
        </div>
        
        <div class="project-content">
            <div class="project-gallery-section">
                <h2>ğŸ“¸ ä½œå“å±•ç¤º</h2>
                <div class="gallery-grid" id="galleryGrid">
                    <div style="text-align: center; padding: 3rem; color: var(--text-secondary);">
                        åŠ è½½ä¸­...
                    </div>
                </div>
            </div>
            
            <!-- æ–‡ä»¶ä¸Šä¼ åŒºåŸŸï¼ˆä»…ç™»å½•åæ˜¾ç¤ºï¼‰ -->
            <div class="upload-section admin-only" style="display: none; margin-top: 3rem;">
                <h3>ğŸ“¤ ä¸Šä¼ ä½œå“</h3>
                <div class="upload-area" id="uploadArea">
                    <div class="upload-icon">ğŸ“</div>
                    <p class="upload-text">ç‚¹å‡»æˆ–æ‹–æ‹½æ–‡ä»¶åˆ°æ­¤å¤„ä¸Šä¼ </p>
                    <p class="upload-hint">æ”¯æŒå›¾ç‰‡ï¼ˆJPGã€PNGã€GIFï¼‰å’Œè§†é¢‘ï¼ˆMP4ã€MOVã€AVIï¼‰<br>å¯åŒæ—¶é€‰æ‹©å¤šä¸ªæ–‡ä»¶ä¸Šä¼ <br><small style="color: var(--text-secondary);">å›¾ç‰‡ä¼šè‡ªåŠ¨å‹ç¼©ï¼Œè§†é¢‘ä¿æŒåŸå§‹ç”»è´¨å’ŒéŸ³é¢‘ï¼ˆä¸å‹ç¼©ï¼‰</small></p>
                    <input type="file" id="fileInput" multiple accept="image/*,video/*" style="display: none;">
                    <button class="upload-btn" id="uploadBtn">é€‰æ‹©æ–‡ä»¶ï¼ˆå¯å¤šé€‰ï¼‰</button>
                </div>
                <div class="upload-progress" id="uploadProgress" style="display: none;">
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                    <p class="progress-text" id="progressText">ä¸Šä¼ ä¸­...</p>
                </div>
            </div>
            <div class="not-logged-in-message" style="text-align: center; padding: 2rem; color: var(--text-secondary); display: none;">
                <p>ğŸ”’ æ­¤åŠŸèƒ½éœ€è¦ç®¡ç†å‘˜ç™»å½•</p>
            </div>
        </div>
    </div>

    <!-- å…¨å±é¢„è§ˆæ¨¡æ€æ¡† -->
    <div id="previewModal" class="modal preview-modal">
        <div class="preview-container">
            <span class="preview-close">&times;</span>
            <button class="preview-nav preview-prev" id="previewPrev">â€¹</button>
            <button class="preview-nav preview-next" id="previewNext">â€º</button>
            <div class="preview-content" id="previewContent">
                <!-- é¢„è§ˆå†…å®¹å°†åŠ¨æ€å¡«å…… -->
            </div>
            <div class="preview-info" id="previewInfo">
                <span class="preview-counter" id="previewCounter"></span>
                <span class="preview-name" id="previewName" style="display: none;"></span>
            </div>
        </div>
    </div>

    <!-- ç™»å½•æ¨¡æ€æ¡† -->
    <div id="loginModal" class="modal">
        <div class="modal-content login-modal-content">
            <div class="modal-header">
                <h2 class="modal-title">åå°ç™»å½•</h2>
                <span class="modal-close login-close">&times;</span>
            </div>
            <div class="modal-body">
                <form id="loginForm" class="login-form">
                    <div class="form-group">
                        <label>å¯†ç </label>
                        <input type="password" id="loginPassword" class="form-input" placeholder="è¯·è¾“å…¥ç®¡ç†å¯†ç " required autocomplete="off">
                    </div>
                    <div id="loginError" class="login-error" style="display: none;"></div>
                    <button type="submit" class="btn btn-primary" style="width: 100%;">ç™»å½•</button>
                </form>
                <div class="login-hint">
                    <p>æç¤ºï¼šè¿™æ˜¯ç®¡ç†åå°ï¼Œåªæœ‰æˆæƒç”¨æˆ·æ‰èƒ½è®¿é—®</p>
                </div>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
    <script>
        // ä½œå“è¯¦æƒ…é¡µé¢ä¸“ç”¨è„šæœ¬
        (function() {
            // ä»URLè·å–ä½œå“ID
            const urlParams = new URLSearchParams(window.location.search);
            const projectId = urlParams.get('id');
            
            if (!projectId) {
                document.getElementById('projectTitle').textContent = 'ä½œå“ä¸å­˜åœ¨';
                document.getElementById('projectDescription').textContent = 'æœªæ‰¾åˆ°æŒ‡å®šçš„ä½œå“ï¼Œè¯·è¿”å›ä½œå“åˆ—è¡¨ã€‚';
                return;
            }
            
            // è®¾ç½®é¡¹ç›®å¤´éƒ¨èƒŒæ™¯ä¸ºå·²ä¸Šä¼ çš„å›¾ç‰‡æˆ–è§†é¢‘å¸§
            async function setProjectHeaderBackground(projectId) {
                try {
                    // ç­‰å¾…ä¸»è„šæœ¬åŠ è½½å®Œæˆ
                    if (typeof getProjectMedia === 'undefined' || typeof captureVideoFrameAsImage === 'undefined') {
                        setTimeout(() => setProjectHeaderBackground(projectId), 100);
                        return;
                    }
                    
                    // è·å–é¡¹ç›®åª’ä½“
                    const mediaArray = await getProjectMedia(projectId);
                    
                    // ä¼˜å…ˆä½¿ç”¨å·²ä¸Šä¼ çš„å›¾ç‰‡ä½œä¸ºèƒŒæ™¯
                    const firstImage = mediaArray.find(m => m.type === 'image' && m.url);
                    
                    if (firstImage) {
                        // ä½¿ç”¨å·²ä¸Šä¼ çš„å›¾ç‰‡ä½œä¸ºèƒŒæ™¯
                        const projectHeader = document.querySelector('.project-header');
                        if (projectHeader) {
                            projectHeader.style.background = `linear-gradient(rgba(0, 0, 0, 0.3), rgba(0, 0, 0, 0.5)), url('${firstImage.url}')`;
                            projectHeader.style.backgroundSize = 'cover';
                            projectHeader.style.backgroundPosition = 'center';
                            projectHeader.style.backgroundRepeat = 'no-repeat';
                        }
                    } else {
                        // å¦‚æœæ²¡æœ‰å›¾ç‰‡ï¼Œå°è¯•ä½¿ç”¨ç¬¬ä¸€ä¸ªè§†é¢‘çš„éšæœºå¸§
                        const firstVideo = mediaArray.find(m => m.type === 'video' && m.url);
                        
                        if (firstVideo) {
                            // ä»è§†é¢‘ä¸­æ•è·éšæœºå¸§ä½œä¸ºèƒŒæ™¯
                            const frameUrl = await captureVideoFrameAsImage(firstVideo.url);
                            
                            if (frameUrl) {
                                const projectHeader = document.querySelector('.project-header');
                                if (projectHeader) {
                                    projectHeader.style.background = `linear-gradient(rgba(0, 0, 0, 0.3), rgba(0, 0, 0, 0.5)), url('${frameUrl}')`;
                                    projectHeader.style.backgroundSize = 'cover';
                                    projectHeader.style.backgroundPosition = 'center';
                                    projectHeader.style.backgroundRepeat = 'no-repeat';
                                }
                            }
                        }
                    }
                } catch (error) {
                    console.error('è®¾ç½®å¤´éƒ¨èƒŒæ™¯å¤±è´¥:', error);
                    // å¦‚æœå¤±è´¥ï¼Œä¿æŒé»˜è®¤çš„è“è‰²èƒŒæ™¯
                }
            }
            
            // ç­‰å¾…ä¸»è„šæœ¬åŠ è½½å®Œæˆ
            function initProjectPage() {
                if (typeof projectData === 'undefined' || typeof loadProjectMedia === 'undefined') {
                    setTimeout(initProjectPage, 100);
                    return;
                }
                
                // åˆå§‹åŒ–å½“å‰é¡¹ç›®ID
                if (typeof window.currentProjectId !== 'undefined') {
                    window.currentProjectId = projectId;
                } else {
                    window.currentProjectId = projectId;
                }
                
                // åŠ è½½ä½œå“ä¿¡æ¯
                const project = projectData[projectId];
                if (project) {
                    document.getElementById('projectTitle').textContent = project.title;
                    document.getElementById('projectDescription').textContent = project.description;
                    
                    const tagsContainer = document.getElementById('projectTags');
                    tagsContainer.innerHTML = project.tags.map(tag => 
                        `<span class="tag">${tag}</span>`
                    ).join('');
                    
                    // ä¸ºè‡ªåª’ä½“è¿è¥é¡¹ç›®æ·»åŠ å°çº¢ä¹¦è·³è½¬æŒ‰é’®
                    if (projectId === 'guoshu') {
                        const projectHeader = document.querySelector('.project-header .container');
                        if (projectHeader) {
                            const xiaohongshuBtn = document.createElement('a');
                            xiaohongshuBtn.href = 'https://www.xiaohongshu.com/user/profile/5ba73b4ed00a1a000195806a?xsec_token=ABNDFAg_HnMA0x3DcJNF_BSQH-Bd6jQFBKFNDNnJmYF-Q%3D&xsec_source=pc_search';
                            xiaohongshuBtn.target = '_blank';
                            xiaohongshuBtn.rel = 'noopener noreferrer';
                            xiaohongshuBtn.className = 'xiaohongshu-btn';
                            xiaohongshuBtn.style.cssText = `
                                display: inline-flex;
                                align-items: center;
                                gap: 0.5rem;
                                color: rgba(255, 255, 255, 0.9);
                                text-decoration: none;
                                margin-top: 1rem;
                                padding: 0.75rem 1.5rem;
                                border-radius: 8px;
                                background: rgba(255, 255, 255, 0.15);
                                backdrop-filter: blur(10px);
                                transition: all 0.3s ease;
                                font-weight: 500;
                            `;
                            xiaohongshuBtn.innerHTML = '<span style="font-size: 1.2rem;">ğŸ“•</span> è®¿é—®å°çº¢ä¹¦è´¦å·';
                            
                            // æ·»åŠ æ‚¬åœæ•ˆæœ
                            xiaohongshuBtn.addEventListener('mouseenter', function() {
                                this.style.background = 'rgba(255, 255, 255, 0.25)';
                                this.style.transform = 'translateY(-2px)';
                            });
                            
                            xiaohongshuBtn.addEventListener('mouseleave', function() {
                                this.style.background = 'rgba(255, 255, 255, 0.15)';
                                this.style.transform = 'translateY(0)';
                            });
                            
                            projectHeader.appendChild(xiaohongshuBtn);
                            
                            // æ·»åŠ æŠ–éŸ³è·³è½¬æŒ‰é’®
                            const douyinBtn = document.createElement('a');
                            douyinBtn.href = 'https://www.douyin.com/jingxuan/search/%E6%9E%9C%E8%94%AC%E7%93%B6?aid=0f3c9401-04d0-46dd-98a3-9b99e989b865&type=general';
                            douyinBtn.target = '_blank';
                            douyinBtn.rel = 'noopener noreferrer';
                            douyinBtn.className = 'douyin-btn';
                            douyinBtn.style.cssText = `
                                display: inline-flex;
                                align-items: center;
                                gap: 0.5rem;
                                color: rgba(255, 255, 255, 0.9);
                                text-decoration: none;
                                margin-top: 1rem;
                                margin-left: 1rem;
                                padding: 0.75rem 1.5rem;
                                border-radius: 8px;
                                background: rgba(255, 255, 255, 0.15);
                                backdrop-filter: blur(10px);
                                transition: all 0.3s ease;
                                font-weight: 500;
                            `;
                            douyinBtn.innerHTML = '<span style="font-size: 1.2rem;">ğŸµ</span> è®¿é—®æŠ–éŸ³è´¦å·';
                            
                            // æ·»åŠ æ‚¬åœæ•ˆæœ
                            douyinBtn.addEventListener('mouseenter', function() {
                                this.style.background = 'rgba(255, 255, 255, 0.25)';
                                this.style.transform = 'translateY(-2px)';
                            });
                            
                            douyinBtn.addEventListener('mouseleave', function() {
                                this.style.background = 'rgba(255, 255, 255, 0.15)';
                                this.style.transform = 'translateY(0)';
                            });
                            
                            projectHeader.appendChild(douyinBtn);
                        }
                    }
                } else {
                    document.getElementById('projectTitle').textContent = 'ä½œå“ä¸å­˜åœ¨';
                    document.getElementById('projectDescription').textContent = 'æœªæ‰¾åˆ°æŒ‡å®šçš„ä½œå“ä¿¡æ¯ã€‚';
                }
                
                // è®¾ç½®å¤´éƒ¨èƒŒæ™¯
                setProjectHeaderBackground(projectId);
                
                // åŠ è½½ä½œå“åª’ä½“
                loadProjectMedia(projectId).catch(err => {
                    console.error('åŠ è½½åª’ä½“å¤±è´¥:', err);
                    const galleryGrid = document.getElementById('galleryGrid');
                    galleryGrid.innerHTML = '<div style="text-align: center; padding: 3rem; color: var(--text-secondary);">åŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•</div>';
                });
            }
            
            initProjectPage();
            
            // åˆå§‹åŒ–ä¸Šä¼ åŠŸèƒ½ï¼ˆå¤ç”¨ä¸»è„šæœ¬çš„å‡½æ•°ï¼‰
            function initUpload() {
                if (typeof uploadFiles === 'undefined') {
                    setTimeout(initUpload, 100);
                    return;
                }
                
                const fileInput = document.getElementById('fileInput');
                const uploadBtn = document.getElementById('uploadBtn');
                const uploadArea = document.getElementById('uploadArea');
                
                if (uploadBtn) {
                    uploadBtn.addEventListener('click', () => {
                        fileInput.click();
                    });
                }
                
                if (uploadArea) {
                    uploadArea.addEventListener('click', () => {
                        fileInput.click();
                    });
                }
                
                if (fileInput) {
                    fileInput.addEventListener('change', async (e) => {
                        const files = e.target.files;
                        if (files && files.length > 0) {
                            // è®¾ç½®å½“å‰é¡¹ç›®IDï¼ˆå¦‚æœå˜é‡å­˜åœ¨ï¼‰
                            if (typeof window.currentProjectId !== 'undefined') {
                                window.currentProjectId = projectId;
                            }
                            // ç¡®ä¿ currentProjectId åœ¨å…¨å±€ä½œç”¨åŸŸ
                            if (typeof currentProjectId === 'undefined') {
                                window.currentProjectId = projectId;
                            } else {
                                currentProjectId = projectId;
                            }
                            await uploadFiles(files);
                            // é‡æ–°åŠ è½½åª’ä½“
                            if (typeof loadProjectMedia !== 'undefined') {
                                await loadProjectMedia(projectId);
                            }
                        }
                    });
                }
            }
            
            initUpload();
            
            // åˆå§‹åŒ–é¢„è§ˆæ¨¡æ€æ¡†
            if (typeof initPreviewModal !== 'undefined') {
                initPreviewModal();
            } else {
                // ç­‰å¾…ä¸»è„šæœ¬åŠ è½½
                setTimeout(() => {
                    if (typeof initPreviewModal !== 'undefined') {
                        initPreviewModal();
                    }
                }, 500);
            }
        })();
    </script>
</body>
</html>
